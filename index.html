<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Juego de Autoevaluación</title>

  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f9; text-align:center; padding:40px; }
    .contenedor { background:#fff; padding:30px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,.1); max-width:860px; margin:auto; }
    h1 { margin: 10px 0 6px; }
    .subtitulo { margin: 0 0 18px; color:#333; }
    .fila { margin: 14px 0; }
    select, button { padding: 10px 12px; font-size: 16px; border-radius: 6px; }
    button { border:0; background:#2c7be5; color:#fff; cursor:pointer; }
    button:hover { background:#1a5fc4; }
    button.secundario { background:#6c757d; }
    button.secundario:hover { background:#545b62; }
    .opcion { display:block; width:100%; margin:8px 0; }
    .estado { margin-top:12px; font-size: 14px; color:#333; }
    .feedback { margin-top: 12px; padding: 12px; border-radius: 8px; display:none; text-align:left; }
    .ok { background:#e8f7ee; border:1px solid #bde5c8; }
    .ko { background:#fdeaea; border:1px solid #f5bcbc; }
    .badge { display:inline-block; padding:6px 10px; border-radius:999px; font-weight:bold; }
    .aceptable { background:#fff3cd; border:1px solid #ffe69c; }
    .bueno { background:#d1ecf1; border:1px solid #bee5eb; }
    .excelente { background:#d4edda; border:1px solid #c3e6cb; }
    .progreso { background:#f8d7da; border:1px solid #f5c6cb; }
    .bloque { text-align:left; margin-top: 14px; }

    .header { display:flex; align-items:center; gap:16px; justify-content:center; flex-wrap:wrap; margin-bottom: 10px; }
    .logo { width: 90px; height: auto; }
    .header-text { text-align:left; max-width: 640px; }
    .header-text .linea1 { font-size: 18px; font-weight: bold; margin: 0; }
    .header-text .linea2 { font-size: 14px; margin: 4px 0 0; color:#333; }
    .header-text .linea3 { font-size: 14px; margin: 2px 0 0; color:#333; }

    .footer {
      margin-top: 22px;
      padding-top: 14px;
      border-top: 1px solid #e6e6e6;
      text-align: left;
      font-size: 13px;
      color: #444;
      line-height: 1.6;
    }
    .footer strong { color:#222; }
  </style>
</head>

<body>
  <div class="contenedor">

    <div class="header">
      <img class="logo" src="logo-uned.png" alt="Logo UNED" />
      <div class="header-text">
        <p class="linea1">UNED — Grado en Pedagogía</p>
        <p class="linea2">Asignatura: <strong>Medio, Recursos Didácticos y Tecnología Educativa</strong></p>
        <p class="linea3">Herramienta abierta de autoevaluación tipo test</p>
      </div>
    </div>

    <h1>Juego de Autoevaluación</h1>
    <p class="subtitulo">Cada partida tiene <strong>10 preguntas</strong>.</p>

    <div class="fila">
      <label for="seleccion"><strong>Elige práctica:</strong></label>
      <select id="seleccion"></select>
      <button onclick="iniciarPartida()">Comenzar</button>
    </div>

    <div id="panelJuego" style="display:none;">
      <div class="estado" id="estado"></div>
      <div class="bloque">
        <h3 id="enunciado"></h3>
        <div id="opciones"></div>
        <div id="feedback" class="feedback"></div>
      </div>
    </div>

    <div id="panelFinal" style="display:none; margin-top:18px;"></div>

    <div class="footer">
      <p><strong>Proyecto de Innovación Docente de la UNED titulado:</strong><br>
      “Arquitectura Small Language Model en chatbots educativos: desarrollo de una herramienta curricular automatizada y su efecto en el desempeño académico del estudiante Universitario”.<br>
      (Resolución del Vicerrectorado de Digitalización e Innovación (UNED). BICI. Nº 1. 30 de septiembre de 2025).</p>

      <p><strong>IP:</strong> Esteban Vázquez-Cano.<br>
      <strong>Desarrollador de esta herramienta mediante Vibe Coding.</strong></p>
    </div>

  </div>

<script>
const NUM_PREGUNTAS_POR_PARTIDA = 10;

let bancoTemas = {};
let bancoExamenes = {};
let seleccionActual = "";
let partida = [];
let indice = 0;
let aciertos = 0;

function barajar(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

window.onload = function() {
  fetch("questions.json")
    .then(r => r.json())
    .then(data => {
      bancoTemas = data.temas || {};
      bancoExamenes = data.examenes || {};
      cargarSelector();
    });
};

function cargarSelector() {
  const sel = document.getElementById("seleccion");
  sel.innerHTML = "";

  const opt0 = document.createElement("option");
  opt0.value = "__MIX_TEMAS__";
  opt0.textContent = "Mezcla de temas";
  sel.appendChild(opt0);

  const ogTemas = document.createElement("optgroup");
  ogTemas.label = "Temas";
  Object.keys(bancoTemas).forEach(t => {
    const opt = document.createElement("option");
    opt.value = "tema::" + t;
    opt.textContent = t;
    ogTemas.appendChild(opt);
  });
  sel.appendChild(ogTemas);
}

function iniciarPartida() {
  seleccionActual = document.getElementById("seleccion").value;

  let pool = [];
  if (seleccionActual === "__MIX_TEMAS__") {
    Object.values(bancoTemas).forEach(arr => pool = pool.concat(arr));
  } else {
    const nombreTema = seleccionActual.split("tema::")[1];
    pool = bancoTemas[nombreTema] || [];
  }

  if (pool.length < NUM_PREGUNTAS_POR_PARTIDA) {
    alert("No hay suficientes preguntas.");
    return;
  }

  partida = barajar([...pool]).slice(0, NUM_PREGUNTAS_POR_PARTIDA);
  indice = 0;
  aciertos = 0;

  document.getElementById("panelJuego").style.display = "block";
  mostrarPregunta();
}

function mostrarPregunta() {
  if (indice >= NUM_PREGUNTAS_POR_PARTIDA) {
    mostrarFinal();
    return;
  }

  const p = partida[indice];
  document.getElementById("estado").textContent =
    "Pregunta " + (indice + 1) + "/" + NUM_PREGUNTAS_POR_PARTIDA +
    " | Aciertos: " + aciertos;

  document.getElementById("enunciado").textContent = p.pregunta;

  const fb = document.getElementById("feedback");
  fb.style.display = "none";
  fb.innerHTML = "";

  const contOpc = document.getElementById("opciones");
  contOpc.innerHTML = "";

  p.opciones.forEach((texto, idx) => {
    const b = document.createElement("button");
    b.className = "opcion";
    b.textContent = texto;
    b.onclick = () => responder(idx);
    contOpc.appendChild(b);
  });
}

function responder(idxElegido) {
  const p = partida[indice];
  const correcta = p.correcta;

  const botones = document.querySelectorAll("#opciones button");
  botones.forEach(b => b.disabled = true);

  const fb = document.getElementById("feedback");

  if (idxElegido === correcta) {
    aciertos++;
    fb.className = "feedback ok";
    fb.innerHTML = "<strong>✅ Respuesta correcta.</strong>";
  } else {
    fb.className = "feedback ko";
    const textoCorrecto = p.opciones[correcta];
    const explicacion = p.explicacion
      ? "<br><br><em>Explicación:</em> " + p.explicacion
      : "";

    fb.innerHTML =
      "<strong>❌ Respuesta incorrecta.</strong><br>" +
      "La correcta es: <strong>" + textoCorrecto + "</strong>." +
      explicacion;
  }

  fb.style.display = "block";

  setTimeout(() => {
    indice++;
    mostrarPregunta();
  }, 2000);
}

function mostrarFinal() {
  document.getElementById("panelJuego").style.display = "none";
  const panel = document.getElementById("panelFinal");
  panel.style.display = "block";

  panel.innerHTML =
    "<h2>Partida finalizada</h2>" +
    "<p>Resultado: <strong>" + aciertos + "/10</strong></p>" +
    "<button onclick='iniciarPartida()'>Jugar otras 10</button>";
}
</script>
</body>
</html>
