<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Juego de Autoevaluación</title>

  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f9; text-align:center; padding:40px; }
    .contenedor { background:#fff; padding:30px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,.1); max-width:860px; margin:auto; }
    h1 { margin: 10px 0 6px; }
    .subtitulo { margin: 0 0 18px; color:#333; }
    .fila { margin: 14px 0; }
    select, button { padding: 10px 12px; font-size: 16px; border-radius: 6px; }
    button { border:0; background:#2c7be5; color:#fff; cursor:pointer; }
    button:hover { background:#1a5fc4; }
    button.secundario { background:#6c757d; }
    button.secundario:hover { background:#545b62; }
    .opcion { display:block; width:100%; margin:8px 0; }
    .estado { margin-top:12px; font-size: 14px; color:#333; }
    .feedback { margin-top: 12px; padding: 10px; border-radius: 8px; display:none; }
    .ok { background:#e8f7ee; border:1px solid #bde5c8; }
    .ko { background:#fdeaea; border:1px solid #f5bcbc; }
    .badge { display:inline-block; padding:6px 10px; border-radius:999px; font-weight:bold; }
    .aceptable { background:#fff3cd; border:1px solid #ffe69c; }
    .bueno { background:#d1ecf1; border:1px solid #bee5eb; }
    .excelente { background:#d4edda; border:1px solid #c3e6cb; }
    .progreso { background:#f8d7da; border:1px solid #f5c6cb; }
    .bloque { text-align:left; margin-top: 14px; }

    /* Cabecera institucional */
    .header {
      display:flex;
      align-items:center;
      gap:16px;
      justify-content:center;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .logo {
      width: 90px;
      height: auto;
    }
    .header-text {
      text-align:left;
      max-width: 640px;
    }
    .header-text .linea1 { font-size: 18px; font-weight: bold; margin: 0; }
    .header-text .linea2 { font-size: 14px; margin: 4px 0 0; color:#333; }
    .header-text .linea3 { font-size: 14px; margin: 2px 0 0; color:#333; }

    /* Pie */
    .footer {
      margin-top: 22px;
      padding-top: 14px;
      border-top: 1px solid #e6e6e6;
      text-align: left;
      font-size: 13px;
      color: #444;
    }
    .footer strong { color:#222; }
  </style>
</head>

<body>
  <div class="contenedor">

    <!-- CABECERA -->
    <div class="header">
      <!-- Si el archivo se llama distinto, cambie logo-uned.png por su nombre -->
      <img class="logo" src="logo-uned.png" alt="Logo UNED" />
      <div class="header-text">
        <p class="linea1">UNED — Grado en Pedagogía</p>
        <p class="linea2">Asignatura: <strong>Medio, Recursos Didácticos y Tecnología Educativa</strong></p>
        <p class="linea3">Herramienta abierta de autoevaluación tipo test</p>
      </div>
    </div>

    <h1>Juego de Autoevaluación</h1>
    <p class="subtitulo">Cada partida tiene <strong>10 preguntas</strong>. Feedback inmediato y práctica por temáticas.</p>

    <div class="fila">
      <label for="tema"><strong>Elige tema:</strong></label>
      <select id="tema"></select>
      <button onclick="iniciarPartida()">Comenzar</button>
    </div>

    <div id="panelJuego" style="display:none;">
      <div class="estado" id="estado"></div>
      <div class="bloque">
        <h3 id="enunciado"></h3>
        <div id="opciones"></div>
        <div id="feedback" class="feedback"></div>
      </div>
    </div>

    <div id="panelFinal" style="display:none; margin-top:18px;"></div>

    <div class="fila" style="margin-top:18px;">
      <button class="secundario" onclick="recargar()">Recargar página</button>
    </div>

    <!-- PIE -->
    <div class="footer">
      <p><strong>Proyecto de investigación / innovación docente:</strong><br>
      Arquitectura Small Language Model en chatbots educativos: desarrollo de una herramienta curricular automatizada y su efecto en el desempeño académico del estudiante universitario.</p>
      <p><strong>Nota:</strong> Recurso abierto y gratuito para práctica formativa (no sustituye la evaluación oficial de la asignatura).</p>
    </div>

  </div>

  <script>
    const NUM_PREGUNTAS_POR_PARTIDA = 10;

    let bancoPorTema = {};
    let temaActual = "";
    let partida = [];
    let indice = 0;
    let aciertos = 0;

    function barajar(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function recargar() { location.reload(); }

    window.onload = function() {
      fetch("questions.json")
        .then(r => r.json())
        .then(data => {
          bancoPorTema = data;
          cargarSelectorTemas(Object.keys(bancoPorTema));
        })
        .catch(() => {
          alert("No se pudo cargar questions.json. Revisa que el archivo exista y esté en la raíz del repositorio.");
        });
    };

    function cargarSelectorTemas(temas) {
      const sel = document.getElementById("tema");
      sel.innerHTML = "";

      const optMix = document.createElement("option");
      optMix.value = "__MEZCLA__";
      optMix.textContent = "Mezcla de temas (aleatorio)";
      sel.appendChild(optMix);

      temas.forEach(t => {
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        sel.appendChild(opt);
      });
    }

    function iniciarPartida() {
      const sel = document.getElementById("tema");
      temaActual = sel.value;

      let pool = [];
      if (temaActual === "__MEZCLA__") {
        Object.values(bancoPorTema).forEach(arr => pool = pool.concat(arr));
      } else {
        pool = bancoPorTema[temaActual] || [];
      }

      if (pool.length < NUM_PREGUNTAS_POR_PARTIDA) {
        alert("En el tema seleccionado no hay suficientes preguntas. Necesitas al menos " + NUM_PREGUNTAS_POR_PARTIDA + ".");
        return;
      }

      const poolCopia = [...pool];
      barajar(poolCopia);
      partida = poolCopia.slice(0, NUM_PREGUNTAS_POR_PARTIDA);

      indice = 0;
      aciertos = 0;

      document.getElementById("panelFinal").style.display = "none";
      document.getElementById("panelJuego").style.display = "block";

      mostrarPregunta();
    }

    function mostrarPregunta() {
      if (indice >= NUM_PREGUNTAS_POR_PARTIDA) {
        mostrarFinal();
        return;
      }

      const p = partida[indice];
      const temaTexto = (temaActual === "__MEZCLA__") ? "Mezcla de temas" : temaActual;

      document.getElementById("estado").textContent =
        "Tema: " + temaTexto + " | Pregunta " + (indice + 1) + "/" + NUM_PREGUNTAS_POR_PARTIDA + " | Aciertos: " + aciertos;

      document.getElementById("enunciado").textContent = p.pregunta;

      const fb = document.getElementById("feedback");
      fb.style.display = "none";
      fb.className = "feedback";
      fb.textContent = "";

      const contOpc = document.getElementById("opciones");
      contOpc.innerHTML = "";

      p.opciones.forEach((texto, idx) => {
        const b = document.createElement("button");
        b.className = "opcion";
        b.textContent = texto;
        b.onclick = () => responder(idx);
        contOpc.appendChild(b);
      });
    }

    function responder(idxElegido) {
      const p = partida[indice];
      const correcta = p.correcta;

      const botones = document.querySelectorAll("#opciones button");
      botones.forEach(b => b.disabled = true);

      const fb = document.getElementById("feedback");

      if (idxElegido === correcta) {
        aciertos++;
        fb.className = "feedback ok";
        fb.textContent = "✅ Respuesta correcta.";
      } else {
        fb.className = "feedback ko";
        const textoCorrecto = p.opciones[correcta];
        const exp = p.explicacion ? (" " + p.explicacion) : "";
        fb.textContent = "❌ Respuesta incorrecta. La correcta es: " + textoCorrecto + "." + exp;
      }

      fb.style.display = "block";

      setTimeout(() => {
        indice++;
        mostrarPregunta();
      }, 700);
    }

    function mostrarFinal() {
      document.getElementById("panelJuego").style.display = "none";

      const panel = document.getElementById("panelFinal");
      panel.style.display = "block";

      const resultado = aciertos;
      let badgeTexto = "";
      let badgeClase = "";

      if (resultado >= 6 && resultado <= 7) {
        badgeTexto = "Aceptable";
        badgeClase = "badge aceptable";
      } else if (resultado >= 8 && resultado <= 9) {
        badgeTexto = "Bueno";
        badgeClase = "badge bueno";
      } else if (resultado === 10) {
        badgeTexto = "Excelente";
        badgeClase = "badge excelente";
      } else {
        badgeTexto = "En progreso";
        badgeClase = "badge progreso";
      }

      panel.innerHTML = `
        <h2>Partida finalizada</h2>
        <p><strong>Resultado:</strong> ${resultado}/10 aciertos</p>
        <p><strong>Insignia:</strong> <span class="${badgeClase}">${badgeTexto}</span></p>
        <div class="fila" style="margin-top:16px;">
          <button onclick="iniciarPartida()">Jugar otras 10</button>
          <button class="secundario" onclick="finalizar()">Salir</button>
        </div>
      `;
    }

    function finalizar() {
      const panel = document.getElementById("panelFinal");
      panel.innerHTML += `<p style="margin-top:12px;">Puedes cerrar la pestaña o recargar cuando quieras volver a jugar.</p>`;
    }
  </script>
</body>
</html>
